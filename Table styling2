
<?php
	include("oneDice.php");
	include("sixDices.php");

	function publishData( $inSum, $inNbr ) {

		$avg = 0;
		if($inSum > 0 && $inNbr > 0) {

			$avg = number_format( ( $inSum / $inNbr ), 2 );
		}

		return "<div><p>Antal: $inNbr</p><p>Totalt: $inSum</p><p>Medel: $avg</p></div>";
	}

	$disabled = true;

?>
<!doctype html>
<html lang="en" >

	<head>
		<meta charset="utf-8">
		<title>Roll the dice...</title>	
		<link href="style/style.css" rel="stylesheet">
		<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD" crossorigin="anonymous">
	</head>

	<body>
	
		<div>

			<?php 
				if( isset( $_POST["btnNewGame"] ) ) {
					
					setcookie("sumOfAllRounds", "0", time() + 3600); //1.b Skapa två kakor
					setcookie("nbrOfRounds", "0", time() + 3600); 
					setcookie("medelValue", "0", time() + 3600);//la till denna kakan så medelvärdet visas när man klickar ned sidan och sedan tar upp den igen
					
					$disabled = false;	//1.c
					echo "<p style='color: green;'>New Game</p>";
					
				}
				


				if( !isset( $_POST["btnRoll"] ) &&		//om ingen knapp trycks
					!isset($_POST["btnNewGame"]) &&  //2.a
					!isset($_POST["btnExit"] ) &&
					isset($_COOKIE["sumOfAllRounds"] ) && //kod från F2, ex3.php
					isset($_COOKIE["nbrOfRounds"])) {

						$sumOfAllRounds = $_COOKIE["sumOfAllRounds"]; //hämtar datan från kakorna
						$nbrOfRounds = $_COOKIE["nbrOfRounds"];
						$medelValue = $_COOKIE["medelValue"];

						echo " Summan av alla rullningar: " .$_COOKIE["sumOfAllRounds"];
						echo " Medelvärdet: " .$_COOKIE["medelValue"];
						echo " Antal slag: " .$_COOKIE["nbrOfRounds"];
						

						$disabled = false;

					} 

					
					$count = isset($_COOKIE["nbrOfRounds"]) ? $_COOKIE["nbrOfRounds"] : 0;
					$summan = isset($_COOKIE["sumOfAllRounds"]) ? $_COOKIE["sumOfAllRounds"] : 0; 

					if (isset($_POST["btnRoll"])) {


					$sixDices = new SixDices();
					$sixDices->rollDices(); //tärningarna rullar bara ibland, vet inte riktigt varför?
					echo $sixDices->svgDices(); //bilder på tärningar
					$sixDices->sumDices();

					$average = $_COOKIE["nbrOfRounds"] > 0 ? $_COOKIE["sumOfAllRounds"] / $_COOKIE["nbrOfRounds"] : 0;  

					$count++;
					$summan += $sixDices->sumDices();

					setcookie("nbrOfRounds", $count, time() + 3600);
					setcookie("sumOfAllRounds", $summan, time() + 3600);
					setcookie("medelValue", $average, time() + 3600 );	

					echo "Summan av senaste slag: " . $sixDices->sumDices(); //Visar summan av senaste slag, kan vara onödig
					echo " Summan av alla slag: " .$_COOKIE["sumOfAllRounds"]; //kan lägga <p> tag på alla echo så de blir på varsin rad
					echo " Antal slag: " .$count;
					echo " Medelvärdet: " .number_format ($average, 2); //number_format så det bara visas två decimaler

					$disabled = false; //gör new game och exit klickbara
					}

					



				if (isset($_POST["btnExit"])) {
					
						setcookie("sumOfAllRounds", "", time() - 3600); //raderar kakorna om man klickar exit
						setcookie("nbrOfRounds", "", time() - 3600); //raderar kakorna om man klickar exit
						setcookie("medelValue", "0", time() - 3600);//raderar kakorna om man klickar exit
				}
			?>

		</div>
		
		<form action="<?php echo( $_SERVER["PHP_SELF"] ); ?>" method="post">
			<input type="submit" name="btnRoll" class="btn btn-primary" value="Roll six dices" <?php if($disabled) { echo("disabled"); } ?>> <!--Ska bort tror jag-->
			<input type="submit" name="btnNewGame" class="btn btn-primary" value="New Game">
			<input type="submit" name="btnExit" class="btn btn-primary" value="Exit" <?php if($disabled) { echo("disabled"); } ?>> <!--Ska bort tror jag-->
		</form>

		<script src="script/animation.js"></script> 
	</body>

</html>


tr:last-child {
    border-bottom: 1px solid gray
}
